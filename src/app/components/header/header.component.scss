@use "_v3/calc" as calc;

$h: #{calc.$cb-hd} !default;
$class: header !default;
$overlay: h-overlay !default;
$m-up: lg !default;

$show-desktop-block: (
  media-query-up: (
    xs: none,
    #{$m-up}: block,
  )
) !default;
$show-mobile-block: (
  media-query-up: (
    xs: block,
    #{$m-up}: none,
  ),
) !default;

$init: (
  tool-def-bg: var(--#{calc.$color}palette-transparent-black-050),
  tool-bg: (media-query-up: (
    xs: var(--#{$h}tool-def-bg),
    #{$m-up}: transparent,
  )),
  tool-fg: var(--#{calc.$cb}fg-strong),
  tool-h: var(--#{calc.$cb}head-toolbar-height),
  tool-item-bg: (media-query-up: (
    xs: transparent,
    #{$m-up}: var(--#{$h}tool-def-bg),
  )),
  tool-blur: (media-query-up: (
    xs: 50px,
    #{$m-up}: none,
  )),
  tool-item-blur: (media-query-up: (
    xs: none,
    #{$m-up}: 50px,
  )),
  tool-item-h: (media-query-up: (
    xs: 2.625rem,
  )),
  tool-item-w: (media-query-up: (
    xs: 2.625rem,
  )),
  tool-offset-x: (media-query-up: (
    xs: 1.5rem
  )),
  tool-item-bg-hover: rgba(0, 0, 0, 0.0),
  tool-radius: (media-query-up: (
    xs: 1.25rem,
    lg: 1.75rem,
  )),
  //overlay
  ov-bg: var(--#{calc.$color}palette-transparent-black-080),
  ov-fg: var(--#{calc.$color}neutral-base-000),
  ov-fg-link: var(--#{calc.$color}neutral-base-030),
  ov-fg-link-hover: var(--#{calc.$color}neutral-base-000),
  ov-radius: (media-query-up: (
    xs: 0,
    #{$m-up}: var(--#{$h}tool-radius),
  )),
  ov-offset-y: (media-query-up: (
    xs: 1.5rem,
    lg: 1.5rem
  )),
  ov-offset-x: (media-query-up: (
    xs: var(--#{calc.$cb}grid-gutter-width),
    lg: 1.5rem
  )),
  // menu
  menu-gap-x: (media-query-up: (
    xs: var(--#{calc.$cb}space-400),
    #{$m-up}: var(--#{calc.$cb}space-400),
  )),
  menu-gap-y: (media-query-up: (
    xs: .025rem,
  )),
  menu-lang-desk-cols: (media-query-up: (
    xs: repeat(1, 1fr),
    sm: repeat(2, 1fr),
    lg: repeat(3, 1fr),
    xl: repeat(4, 1fr),
  )),
  menu-desk-min-h: (media-query-up: (
    xs: 27.81rem,
  )),
  menu-desk-desk-2-cols: (media-query-up: (
    xs: 1,
    sm: 2,
    xl: 2,
  )),
  menu-level-1-font-size:(media-query-up: (
    xs: var(--#{calc.$cb}font-size-225),
    #{$m-up}: var(--#{calc.$cb}font-size-base),
  )),
  menu-font-size:(media-query-up: (
    xs: var(--#{calc.$cb}font-size-120),

  )),
  menu-font-size-long-string:(media-query-up: (
    xs: var(--#{calc.$cb}font-size-base),
  )),
  brand-h:(media-query-up: (
    xs: 1.625rem,
    lg: 2.375rem,
  )),
  brand-font-size:(media-query-up: (
    xs: 1.5rem,
  )),
  brand-w-rel: var(--#{calc.$cb}brand-w-rel),
  show-desktop-block: $show-desktop-block,
  show-mobile-block: $show-mobile-block,
) !default;

@mixin font-level-2-serif() {
  font-weight: var(--#{calc.$cb}font-weight-light);
  font-family: var(--#{calc.$cb}font-family-serif);
  line-height: 1.7;
  font-size: var(--#{$h}menu-level-1-font-size);
}

::ng-deep :root {
  @include calc.css-initVars($init, $h);
}
:host {
  display: block;
  pointer-events: none;
}

:host ::ng-deep {


  .#{$class} {
    //border-bottom: 1px solid var(--#{calc.$cb}divider);
    display: flex;
    justify-content: space-between;
    align-items: center;
    min-height: var(--#{calc.$cb}head-toolbar-height);
    padding-top: var(--#{calc.$cb}header-top-offset);
    pointer-events: none;


    &__container {
      z-index: 5;
    }

    &.has-long-strings {
      @media only screen and (max-width: 1340px) {
        --#{$h}menu-font-size: var(--#{$h}menu-font-size-long-string);
      }

    }


    &__grid {
      display: flex;
      justify-content: space-between;
      align-items: center;

      border-radius: var(--#{$h}tool-radius);
      background-color: var(--#{$h}tool-bg);
      z-index: 3;

      &.is-hidden {
        visibility: hidden;
      }

      @include calc.media-breakpoint-down(lg) {
        backdrop-filter: blur(var(--#{$h}tool-blur));
      }


      &, & a {
        color: var(--#{calc.$cb}fg-strong);
      }

    }

    &__brand, &__ctrl {
      pointer-events: all;
      background-color: var(--#{$h}tool-item-bg);
      border-radius: var(--#{$h}tool-radius);
      backdrop-filter: blur(var(--#{$h}tool-item-blur));

      &, .#{$class}__grid__item, .#{$class}__grid__item.nav {
        display: grid;
        grid-auto-flow: column;
        align-items: center;
        justify-content: center;
        min-height: var(--#{calc.$cb}head-toolbar-height);
        padding-left: 0;

        &.globe-menu {
          min-width: 5.25rem;
          padding-left: var(--#{$h}tool-offset-x);
        }
      }
    }

    &__brand {
      position: relative;

      .dummy-trigger-menu {
        position: absolute;
        top: 0;
        left: 0;
        bottom: 0;
        right: 0;

        cursor: pointer;
        background-color: transparent;
      }
    }

    .#{$class}__grid__item {
      display: grid;
      align-items: center;
      min-height: var(--#{$h}tool-item-h);
      border-radius: var(--#{$h}tool-radius);
      padding: 0 var(--#{$h}tool-offset-x);

      &:hover {
        background-color: var(--#{$h}tool-item-bg-hover);
      }
    }
  }


  .show-desktop-only {
    display: var(--#{$h}show-desktop-block);
  }

  .show-mobile-only {
    display: var(--#{$h}show-mobile-block);
  }

}

:host ::ng-deep, ::ng-deep .h-overlay {
  .brand {
    --#{calc.$cb-subject-logo}fg: var(--#{calc.$cb}fg-strong);
    --#{calc.$cb-subject-logo}brand-h: var(--#{$h}brand-h);
    --#{calc.$cb-subject-logo}font-size: var(--#{$h}brand-font-size);
    --#{calc.$cb-subject-logo}display-text: var(--#{$h}show-desktop-block);
    display: inline-flex;
    color: var(--#{calc.$cb}body-clr);
    --#{calc.$cb-subject-logo}fg: var(--#{calc.$cb}body-clr);
    text-decoration: none;
  }

  .nav {
    display: flex;
  }

  .#{$class}__grid__item {

  }

  #{calc.$btn-selector} {
    &.nav__btn {
      min-height: var(--#{$h}tool-item-h);

      &.mdc-icon-button {
        width: var(--#{$h}tool-item-w);
        height: var(--#{$h}tool-item-h);
      }

      @include calc.btn-mixins-button-override($overrides: (
        fg: var(--#{calc.$cb}fg-strong),
        bg: transparent,
        hover: (
          bg: var(--#{calc.$color}palette-transparent-white-020),
        )
      ));
    }

    &.btn--link {
      transition: all 0.35s ease, color 0.35s ease;

      @include calc.btn-mixins-button-override($overrides: (
        fg: var(--#{$h}ov-fg-link),
        bg: transparent,
        hover: (
          fg: var(--#{$h}ov-fg-link-hover),
        )
      ));
      .btn__grid {
        display: flex;
        width: 100%;
      }

      &:hover {
        transform: translateX(0.5rem);
      }
    }
  }
}


// overlays

::ng-deep {
  .#{$overlay} {
    display: flex;
    flex-direction: column !important;


    background-color: var(--#{$h}ov-bg);
    border-radius: var(--#{$h}ov-radius);
    backdrop-filter: blur(50px);
    color: var(--#{$h}ov-fg);

    > * {
      padding: var(--#{$h}ov-offset-y) var(--#{$h}ov-offset-x);
      width: 100%;
      display: grid;
    }

    .#{$overlay}__content {
      flex: 0 1 auto;
      @include calc.loc-scroll();
    }

    .menu {
      list-style: none;
      display: grid;
      column-gap: var(--#{$h}menu-gap-x);
      row-gap: var(--#{$h}menu-gap-y);
      //width: 100%;
      margin: 0;
      padding: 0;
      font-size: var(--#{$h}menu-font-size);

      a {
        display: flex;
      }

      &--lang {
        grid-template-columns: var(--#{$h}menu-lang-desk-cols);
      }

      &--row {
        display: flex;
        align-items: center;
      }

      &--nav {
        column-gap: var(--#{calc.$cb}space-150);
      }

      &--level-1 {
        @include font-level-2-serif();

        --#{$h}menu-gap-y: var(--#{calc.$cb}space-100);
        .btn--link:not(.btn--link--lang){
          --#{calc.$btn}btn-link-font-size: var(--#{$h}menu-level-1-font-size);
        }
        .btn--link.btn--link--lang {
          --#{calc.$btn}btn-link-font-size: var(--#{calc.$cb}font-size-150);
        }
        .mat-divider {
          margin: var(--#{calc.$cb}space-300) 0;
        }
      }

      &--level-2 a {
        align-items: flex-end;
        --cb-btn-min-h: 3.5rem;
      }

      &--level-3 a {
        font-size: var(--#{calc.$cb}font-size-sm);
        --cb-btn-min-h: var(--#{calc.$cb}font-size-sm);
      }

      .btn--title {
        opacity:.7;
      }
    }

    &.#{$overlay}--mobile {
      position: fixed !important;
      top:0; left:0; bottom:0; right:0;
      overflow: hidden;
      max-height: 100dvh !important;
      height: 100dvh;
      max-width: 100dvw;
      width: 100dvw !important;
      .block--submenu {
        .block__header {
          .title{
            @include font-level-2-serif();
          }
        }

      }

      .menu {
        &--nav {
          justify-content: space-between;
        }
      }
    }


    &.#{$overlay}--desk {
      overflow: hidden;
      min-height: var(--#{$h}menu-desk-min-h);

      .#{$overlay}__header {
        padding-top: 0;
        padding-bottom: 0;
        min-height: var(--#{calc.$cb}head-toolbar-height);
      }

      .#{$overlay}__content {
        height: 100%;
        display: grid;
        > * {
          min-width: 0;
        }

        .#{$overlay}__content__grid {
          grid-template-columns: minmax(12rem, 21.875rem) 1fr;
          row-gap: var(--#{$h}menu-gap-y);
          column-gap: var(--#{calc.$cb}space-400);

          > .block__content {
            display: flex;

            &:not(.block__content--menu) {
              justify-content: end;
              align-items: end;
            }

            &.block__content--menu {
              justify-content: center;

              .menu--level-2 {
              }
            }

          }
        }
      }

      .menu {
        &--level-2 {
          display: block;

          &.multi-column {
            column-count: var(--#{$h}menu-desk-desk-2-cols); /* number of columns */
            column-gap: var(--#{calc.$cb}space-600);


            > li {
              min-width: 14rem;
              break-inside: avoid;
            }
          }

        }
      }
    }

    .#{calc.$card-class}.card--postal {
      cursor: pointer;
      width: 100%;
      max-width: 750px;
      height: 250px;
      --#{calc.$card}radius: var(--#{calc.$cb}radius-3);
      --#{calc.$cb}media-radius: var(--#{calc.$cb}radius-3);
      --#{calc.$cb}media-h: 100%;
      --#{calc.$cb}media-w: 100%;
      transition: all .2s ease-in-out;

      img {
        transition: all .2s ease-in-out;
        filter: brightness(.85);
      }

      &:hover img {
        filter: brightness(.5);
      }

      .#{calc.$card-class}__body {
        display: grid;
        align-content: end;

        height: 100%;
        z-index: 1;
        padding: var(--#{calc.$cb}space-300) var(--#{calc.$cb}space-300);

        > .block {
          width: 100%;
          grid-template-columns: 1fr auto;
          align-content: center;
          justify-content: space-between;
          gap: 1rem;

          .block__thumb {
            display: flex;
            align-items: center;
          }
        }
      }

      .media {
        z-index: 0;

        &, & > * {
          position: absolute;
          top: 0;
          left: 0;
          right: 0;
          bottom: 0;
          padding: 0;
        }
      }
    }
  }
}




.seo-language-buttons {
  visibility: hidden;
  position: absolute;
  width: 1px;
  height: 1px;
  overflow: hidden;
}




