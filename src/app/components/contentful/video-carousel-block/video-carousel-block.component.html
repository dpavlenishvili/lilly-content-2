<div class="video-carousel-block">
  <div class="video-carousel-block__header">
    @if (fields()?.label) {
      <div class="video-carousel-block__label">{{ fields()?.label }}</div>
    }
    <h1 class="video-carousel-block__title">
      {{ fields()?.title }}
    </h1>
    @if (fields()?.subtitle) {
      <p class="video-carousel-block__subtitle">{{ fields()?.subtitle }}</p>
    }
  </div>

  <div class="video-carousel-block__controls">
    @if (fields()?.categoryTabs?.length) {
      <!-- Desktop Category Filter Pills -->
      <div class="nav--tabs is-nav-desktop">
        <div class="nav--tabs__container">
          <lilly-one-row-navigation>
            <div class="nav--tabs__content">
              @for (tab of fields()?.categoryTabs; track tab.sys.id) {
                <button
                  mat-button
                  class="nav--tabs__item"
                  [class.selected]="selectedCategory() === tab.fields.filterValue"
                  [attr.aria-selected]="selectedCategory() === tab.fields.filterValue"
                  [attr.aria-label]="tab.fields.label"
                  (click)="onCategoryClick(tab)"
                  tabindex="0">
                  <span>{{ tab.fields.label }}</span>
                </button>
              }
            </div>
          </lilly-one-row-navigation>
        </div>
      </div>

      <!-- Mobile Category Dropdown -->
      <div class="form-group is-nav-mobile">
        @if (fields()?.categoryMobileDropdownLabel) {
          <div class="label--external">{{ fields()?.categoryMobileDropdownLabel }}</div>
        }
        <mat-form-field class="category-dropdown has-out-hint">
          <mat-select [value]="selectedCategory()" (selectionChange)="selectedCategory.set($event.value)">
            @for (tab of fields()?.categoryTabs; track tab.sys.id) {
              <mat-option [value]="tab.fields.filterValue">{{ tab.fields.label }}</mat-option>
            }
          </mat-select>
        </mat-form-field>
      </div>
    }

    @if (fields()?.ctaButton?.fields) {
      <button
        class="return-home-btn"
        (click)="onCtaClick()">
        {{ fields()?.ctaButton?.fields?.text }}
        <mat-icon>arrow_back</mat-icon>
      </button>
    }
  </div>

  <div class="video-carousel-block__wrapper">
    <owl-carousel-o #owlCarousel [options]="customOptions()" (navigated)="onNavData($event)" (changed)="onChanged($event)">
      @for (video of filteredVideos(); track video.sys.id) {
        <ng-template carouselSlide [id]="video.sys.id">
          <div
            class="video-card"
            (click)="onVideoClick(video)"
            (keydown.enter)="onVideoClick(video)"
            tabindex="0"
            role="button"
            [attr.aria-label]="'Play video: ' + video.fields.title">

            <div class="video-card__category">{{ video.fields.categoryLabel }}</div>

            <img
              class="video-card__image"
              [src]="video.fields.thumbnail.fields.file.url"
              [alt]="video.fields.title"
              loading="lazy"
              decoding="async" />

            <div class="video-card__footer">
              <div class="video-card__title">
                @if (video.fields.icon?.fields?.file?.url) {
                  <img
                    class="video-card__icon"
                    [src]="video.fields.icon.fields.file.url"
                    alt=""
                    loading="lazy" />
                }
                <span>{{ video.fields.title }}</span>
              </div>

              <button class="video-card__play-btn" aria-label="Play video">
                <mat-icon>play_arrow</mat-icon>
              </button>
            </div>
          </div>
        </ng-template>
      }
    </owl-carousel-o>

    @if (filteredVideos().length > maxVisibleCards()) {
        <button
                class="carousel-nav carousel-nav--prev"
                (click)="prev()"
                [disabled]="isPrevDisabled()"
                aria-label="Previous videos">
            <mat-icon>chevron_left</mat-icon>
        </button>
        <button
                class="carousel-nav carousel-nav--next"
                (click)="next()"
                [disabled]="isNextDisabled()"
                aria-label="Next videos">
            <mat-icon>chevron_right</mat-icon>
        </button>
    }
  </div>

  @if (filteredVideos().length > maxVisibleCards()) {
    <div class="carousel-progress">
      <div class="carousel-progress__bar" [style.width.%]="scrollProgress()"></div>
    </div>
  }
</div>
